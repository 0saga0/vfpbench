// 2013 Hiroyuki Ogasawara
// vim:ts=4 sw=4 noet:

#include	"CoreLib.h"
#include	"Math.h"


namespace flatlib {
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------

namespace math {
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------


unsigned int	FloatToHalf( float fp )
{
	union {
		uint32_t	ival;
		float		fval;
	} v;
	v.fval= fp;
	uint32_t	fbit= v.ival;
	if( !fbit ){
		return	0;
	}
	int32_t		e=((fbit & 0x7f800000)>>23) - 127 + 15;
	if( e <= 0 ){
		return	0;
	}
	if( e > 31 ){
		e= 31;
	}
	uint32_t	s=  fbit & 0x80000000;
	uint32_t	f=  fbit & 0x007fffff;
	return	((s>>16)&0x8000) | ((e<<10) & 0x7c00) | ((f>>13) & 0x03ff);
}



float	HalfToFloat( unsigned int hp )
{
	if( !hp ){
		return	0.0f;
	}
	uint32_t	s=  hp & 0x8000;
	int32_t		e=((hp & 0x7c00) >>10) - 15 + 127;
	uint32_t	f=  hp & 0x03ff;
	union {
		uint32_t	ival;
		float		fval;
	} v;
	v.ival= (s<<16) | ((e <<23)&0x7f800000) | (f<<13);
	return	v.fval;
}





//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
}

//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
}


